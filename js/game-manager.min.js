function startGame(e){const t=Number(matchMinutesSelect.value||2);modal.style.display="none",resize(),resetObjects(),tryFullscreen();try{"suspended"===audioCtx.state&&audioCtx.resume()}catch(e){console.error("Could not resume audio context:",e)}startMatch(t,e)}function startMatch(e,t){state.gameMode=t,state.goldenGoal=!1,timerEl.classList.remove("golden-goal-text"),playerALabel.textContent="singlePlayer"===t||"ai-vs-ai"===t?"هوش مصنوعی":"بازیکن ←",startCrowd(),state.matchTime=Math.max(10,Math.floor(60*e)),state.timeLeft=state.matchTime,state.running=!1,state.paused=!1,state.scoreA=0,state.scoreB=0,scoreAEl.textContent=0,scoreBEl.textContent=0,timerEl.textContent=formatTime(state.timeLeft),lastTouch=null,totalReward=0,episodeRewardDetails={},messageOverlay.classList.remove("show"),window.matchInterval&&clearInterval(window.matchInterval);let a=3;!function e(){a>0?(showMessage(a,"white"),playClick(440,.1,.2),a--,setTimeout(e,1e3)):(showMessage("شروع!","#ffd166"),playWhistle(),state.running=!0,"singlePlayer"!==state.gameMode&&"ai-vs-ai"!==state.gameMode||(lastState=getGameState()),window.matchInterval=setInterval((()=>{!state.running||state.paused||state.goldenGoal||(state.timeLeft-=1,timerEl.textContent=formatTime(state.timeLeft),state.timeLeft<=10&&state.timeLeft>0&&(showMessage(state.timeLeft,"#FFD700"),playClick(1200,.1,.4)),state.timeLeft<=0&&handleTimeUp())}),1e3))}()}function handleTimeUp(){state.scoreA===state.scoreB?(state.goldenGoal=!0,state.running=!0,window.matchInterval&&clearInterval(window.matchInterval),timerEl.textContent="گل طلایی",timerEl.classList.add("golden-goal-text"),messageOverlay.innerHTML='<div class="golden-goal-text">گل طلایی</div>',messageOverlay.classList.add("show"),setTimeout((()=>messageOverlay.classList.remove("show")),2500),playWhistle()):endMatch()}function togglePause(){state.running&&(state.paused=!state.paused,state.paused?(stopCrowd(),showPauseMenu()):(startCrowd(),modal.style.display="none",last=performance.now(),requestAnimationFrame(loop)))}